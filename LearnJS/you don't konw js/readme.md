# You Don't Know Js

## 作用域是什么

「作用域」是根据名称查找变量的一套「规则」

### 编译原理

javaScript 编译分为三个阶段 

**词法分析** 

将有字符组成的字符串「对编译语言来说」分割成有意义的代码块

**语法分析**

将词法单元流转换成一个代表程序语法结构的数 「抽象语法树」

**代码生成**

将抽象语法树「AST」转化为机器可执行的代码

### 编译器术语

LHS ： 查找的目的是对变量进行赋值

RHS ： 查找的目的是为了获取变量的值

举个栗子

```js
var a = 3; //LHS
```

查找 `a` 为了对其进行赋值

```js
console.log(b); //RHS
```

查找 `b` 为了获取其值并打印

区分 LHS 和 RHS 很有必要，因为不成功的 RHS 会抛出 ReferenceError ，而不成功的 LHS 会导致自动隐式地创建一个全局变量「非严格模式」

### 理解作用域

```js
var a = 2
```

1. 首先 `var a` 在其作用域中声明新变量，这会是在**最开始的阶段，也就是代码执行前**
2. `a = 2` 进行 LHS 查询，并对变量 `a` 进行赋值

LHS 和 RHS 都会在当前作用域中查询，如果有需要，会向上级作用域继续查找，最后抵达全局作用域，无论找到没找到都会停止

## 词法作用域

「词法作用域」是由你在写代码时将变量和块作用域写在哪里来决定的，因此当「词法分析器」处理代码时会保持作用域不变（大多数情况下）

换句话说，无论函数在哪里被调用，也无论如何被调用，它的词法作用域都只由**函数被声明时所处的位置决定**

### 欺骗词法

JavaScript 有两个机制可以「欺骗」词法作用域： `eval(...)` 和 `with` ，前者运行对一段代码字符串，后者本质上是通过将一个对象的引用当作作用域来处理，将对象的属性当作标识符处理，从而创建了一个新的词法作用域

**注意**

这两个机制的副作用是引擎无法在编译时对作用域查找进行优化，因为引擎只能谨慎地认为这样的优化是无效的。使用这其中任何一个机制都会导致代码运行变慢

