## XSS

XSS「Cross-site script」因为与 CSS 简写重合所以改为 XSS

其原理是向网站中插入恶意的 HTML 代码。当其他用户浏览该网站的时候，该段 HTML 代码会自动执行，从而达到攻击的目的。如盗取用户的 Cookie，页面重定向，破坏页面结构

:chestnut:**举个栗子**

网站的评论系统没有过滤 XSS 攻击，当有用户添加评论为

```js
<script>
  while(true) {
    alert("1");
  }
</script>
```

这段代码就会插入到此网站的 DOM 结构中，因为没有过滤掉或进行处理，此段代码也会执行。

### XSS 分类

XSS 分为两种类型：「持久型 XSS」 和 「非持久型 XSS」

**持久型 XSS**「存储型」

持久型 XSS 就是对客户端攻击的脚本直接植入到服务器上，从而导致每个用户访问此网站都会遭到 XSS 的攻击

**非持久型 XSS**「反射型」

非持久型 XSS 是对一个页面的某个参数做文章，把精心构造好的恶意脚本包装在 URL 参数中，再讲 URL 发布到网上，骗取用户访问


手段主要有

- HTML 节点内容的注入 添加评论
- HTML 属性 通过 url传值动态修改 `img` 的 `src` 
- javascript 代码 传递的变量添加双引号并在双引号后面添加要注入的脚本

### 防御 XSS

对于非持久型 XSS

- 现代浏览器都对 xss 有了一定的防范作用，但也仅限于 html 节点和属性的注入。
- Web 页面渲染的所有内容和数据必须来自于服务器
- 尽量不使用 `eval`, `new Function()`,`window.setTimeout()`,`innerHTML`等可执行字符串的方法
- 前端渲染的时候要对任何字段都需要做转义
- 对于用户输入的要添加限制，比如用户名和密码只允许字符和数字，email 必须为 email 格式

对于持久型 XSS

- 后端在入库的时候不相信任何前端的数据，将所有的字段统一进行转义处理
- 后端在传递给前端数据的时候统一做转义处理
- 前端不相信后端传来的数据，任何字段也都需要做转义处理
